-- AutoExec Volcano Safe Loader + Respawn UI Detection
task.defer(function()
    repeat task.wait() until game:IsLoaded()

    local Players = game:GetService("Players")
    local TweenService = game:GetService("TweenService")
    local TeleportService = game:GetService("TeleportService")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")

    repeat task.wait() until Players.LocalPlayer
    local LocalPlayer = Players.LocalPlayer
    local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

    -- CONFIG
    local FORCE_MODE = "REJOIN" -- "RESPAWN" / "REJOIN"
    local AUTO_RESPAWN_UI = true -- auto klik tombol respawn UI
    local TELEPORT_STYLE = "instant"
    local DEFAULT_DELAY = 1.5
    local HEIGHT_OFFSET = 5
    local RESPAWN_DELAY = 3
    local START_DELAY = 5
    local STUCK_TIMEOUT = 15
    local FORCE_DELAY_LOAD = 5
    local runCounter = 0

    -- Data checkpoint
    local checkpoints = {
    {name="CP 1", pos={y=126.9980, x=872.4426, z=230.8145}, delay=1.5, style="instant"},
    {name="CP 2", pos={y=367.8017, x=190.5261, z=203.7687}, delay=1.5, style="instant"},
    {name="CP 3", pos={y=324.0525, x=310.5250, z=444.3988}, delay=1.5, style="instant"},
    {name="CP 4", pos={y=383.9630, x=534.5471, z=707.3785}, delay=1.5, style="instant"},
    {name="CP 5", pos={y=380.5244, x=545.7269, z=453.9121}, delay=1.5, style="instant"},
    {name="CP 6", pos={y=552.3300, x=290.2575, z=826.9859}, delay=1.5, style="instant"},
    {name="CP 7", pos={y=467.4644, x=76.5211, z=596.1738}, delay=1.5, style="instant"},
    {name="CP 8", pos={y=491.8715, x=-128.8938, z=182.6215}, delay=1.5, style="instant"},
    {name="CP 9", pos={y=440.9980, x=85.0706, z=40.0792}, delay=1.5, style="instant"},
    {name="CP 10", pos={y=399.0446, x=289.0727, z=20.0770}, delay=1.5, style="instant"},
    {name="CP 11", pos={y=296.9980, x=169.3672, z=-92.4450}, delay=1.5, style="instant"},
    {name="CP 12", pos={y=297.7289, x=-45.9771, z=-259.6374}, delay=1.5, style="instant"},
    {name="CP 13", pos={y=317.3076, x=99.6528, z=-257.2659}, delay=1.5, style="instant"},
    {name="CP 14", pos={y=616.8849, x=59.0597, z=17.2464}, delay=1.5, style="instant"},
    {name="CP 15", pos={y=604.9980, x=-105.7877, z=322.4513}, delay=1.5, style="instant"},
    {name="CP 16", pos={y=752.9980, x=-219.3953, z=549.0682}, delay=1.5, style="instant"},
    {name="CP 17", pos={y=764.9980, x=-416.5332, z=760.1754}, delay=1.5, style="instant"},
    {name="CP 18", pos={y=836.9980, x=-81.6535, z=805.9637}, delay=1.5, style="instant"},
    {name="CP 19", pos={y=892.9980, x=-376.4395, z=493.0921}, delay=1.5, style="instant"},
    {name="CP 20", pos={y=804.9980, x=-650.7967, z=687.3696}, delay=1.5, style="instant"},
    {name="CP 21", pos={y=892.9980, x=-914.3771, z=831.3945}, delay=1.5, style="instant"},
    {name="CP 22", pos={y=880.9979, x=-907.9720, z=493.3469}, delay=1.5, style="instant"},
    {name="CP 23", pos={y=868.9980, x=-637.0951, z=419.1562}, delay=1.5, style="instant"},
    {name="CP 24", pos={y=760.9980, x=-400.0076, z=375.4759}, delay=1.5, style="instant"},
    {name="CP 25", pos={y=724.9980, x=-594.6006, z=-300.4407}, delay=1.5, style="instant"},
    {name="CP 26", pos={y=796.9980, x=-872.6385, z=-523.2459}, delay=1.5, style="instant"},
    {name="CP 27", pos={y=844.9980, x=-1039.2716, z=-316.2741}, delay=1.5, style="instant"},
    {name="CP 28", pos={y=824.9980, x=-1153.8458, z=190.1352}, delay=1.5, style="instant"},
    {name="CP 29", pos={y=940.5388, x=-957.8245, z=150.6406}, delay=1.5, style="instant"},
    {name="CP 30", pos={y=932.9980, x=-1183.7283, z=448.2964}, delay=1.5, style="instant"},
    {name="CP 31", pos={y=993.3417, x=-1217.9308, z=735.3470}, delay=1.5, style="instant"},
    {name="CP 32", pos={y=1031.5978, x=-1890.5953, z=702.8469}, delay=1.5, style="instant"},
    {name="CP 33", pos={y=1092.9807, x=-1855.8414, z=-221.3439}, delay=1.5, style="instant"},
    {name="CP 34", pos={y=1236.7886, x=-1540.7406, z=506.7415}, delay=1.5, style="instant"},
    {name="CP 35", pos={y=1732.0005, x=-2996.2842, z=333.4418}, delay=1.5, style="instant"},
    {name="CP 36", pos={y=1740.9979, x=-3040.9434, z=304.8416}, delay=1.5, style="tween"},
}


    -- Utils
    local function waitForCharacter()
        while not LocalPlayer.Character
            or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            or not LocalPlayer.Character:FindFirstChild("Humanoid") do
            LocalPlayer.CharacterAdded:Wait()
            task.wait(0.3)
        end
        return LocalPlayer.Character
    end

    local function teleportTo(pos, style)
        local char = waitForCharacter()
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        local target = Vector3.new(pos.x, pos.y + HEIGHT_OFFSET, pos.z)
        if style == "tween" then
            local tween = TweenService:Create(hrp, TweenInfo.new(1, Enum.EasingStyle.Linear), {CFrame = CFrame.new(target)})
            tween:Play()
            tween.Completed:Wait()
        else
            hrp.CFrame = CFrame.new(target)
        end
    end

    local function isOnGround()
        local char = LocalPlayer.Character
        if not char then return false end
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if not hrp then return false end
        local ray = Ray.new(hrp.Position, Vector3.new(0,-10,0))
        local part, pos = workspace:FindPartOnRay(ray, char)
        return part ~= nil and (hrp.Position.Y - pos.Y) < (HEIGHT_OFFSET + 1)
    end

    local function waitUntilGroundOrTimeout()
        local start = tick()
        while true do
            if isOnGround() then return true end
            if tick() - start > STUCK_TIMEOUT then return false end
            task.wait(0.3)
        end
    end

    -- üî• Auto-detect UI Respawn
    if AUTO_RESPAWN_UI then
        PlayerGui.ChildAdded:Connect(function(child)
            if child:IsA("ScreenGui") and child:FindFirstChildWhichIsA("TextButton", true) then
                local button = child:FindFirstChildWhichIsA("TextButton", true)
                if button and button.Text:lower():find("respawn") then
                    print("[AutoSummit] üü¢ Detected Respawn UI ‚Üí Auto click")
                    task.wait(1)
                    pcall(function() firesignal(button.MouseButton1Click) end)
                end
            end
        end)
    end

    local function doRespawn()
        local remote = ReplicatedStorage:FindFirstChild("RespawnPlayer")

        print("[AutoSummit] üíÄ Trigger respawn...")
        local char = waitForCharacter()
        local hum = char:FindFirstChild("Humanoid")
        if hum then hum.Health = 0 end

        task.wait(1.5)
        if remote then
            print("[AutoSummit] üîÅ Respawn via RemoteEvent")
            remote:FireServer()
        end

        task.wait(RESPAWN_DELAY)
    end

    local function autoSummit()
        while true do
            for _, cp in ipairs(checkpoints) do
                local success = false
                local tries = 0
                while not success and tries < 3 do
                    tries += 1
                    teleportTo(cp.pos, cp.style or TELEPORT_STYLE)
                    success = waitUntilGroundOrTimeout()
                    if not success then
                        warn("[AutoSummit] ‚ùå Stuck di " .. cp.name .. " ‚Üí retry " .. tries)
                        task.wait(1)
                    else
                        print("[AutoSummit] ‚úÖ " .. cp.name)
                    end
                end
                task.wait(cp.delay or DEFAULT_DELAY)
            end

            runCounter += 1
            print("[AutoSummit] üéâ Run ke-" .. runCounter .. " selesai!")

            if FORCE_MODE == "REJOIN" then
                print("[AutoSummit] üîÑ Rejoin server...")
                TeleportService:Teleport(game.PlaceId, LocalPlayer)
                return
            else
                doRespawn()
            end
        end
    end

    -- Main Loop
    while true do
        local ok, err = pcall(function()
            waitForCharacter()
            print("[AutoSummit] ‚è≥ Loading delay " .. FORCE_DELAY_LOAD .. "s...")
            task.wait(FORCE_DELAY_LOAD)
            task.wait(START_DELAY)
            autoSummit()
        end)
        if not ok then
            warn("[AutoSummit] ‚ö†Ô∏è Error:", err)
            task.wait(5)
        end
    end
end)
